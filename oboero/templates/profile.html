{% extends "_layout/_base.html" %}
{% block head %}
{% endblock %}

{% block content %}
<section id="profile-page">
        <nav class="pure-menu pure-menu-open pure-menu-horizontal">
            <a href="#" class="pure-menu-heading">「覚えろ」</a>

            <ul>
                <li><a href="{{ url_for('index.about') }}"><i class="fa fa-cube"></i>&nbsp;About</a></li>
                <li><a href="http://github.com/kelvintaywl/oboero"><i class="fa fa-github"></i>&nbsp;Github</a></li>
                <li><a onclick="logout()"><i class="fa fa-sign-out"></i>&nbsp;logout</a></li>
                <li> Welcome {{ current_user.username }}</li>
            </ul>
            <div id = "profile-icon" class="pure-menu-heading" style="float: right"><img src= "{{  current_user.pic_url }}" class = "circular-profile"></div>
        </nav>
        <div class="pure-g" style="margin-top: 50px;">
            <div class="pure-u-md-1-3">
                <div class="placard">
                    <img src="static/img/kanji.png">
                    <div class="pure-menu pure-menu-open">
                        <a class="pure-menu-heading"><h4>Kanji Crush Saga</h4></a>

                        <ul>
                            <li><a><progress max="100" value="50"></progress></a></li>
                            <li><a href="#">CONTINUE</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="pure-u-md-1-3">
                <div class="placard">
                    <img src="static/img/wordcount_min.png">
                    <div class="pure-menu pure-menu-open">
                        <a class="pure-menu-heading"><h4>Dictionary Master</h4></a>

                        <ul>
                            <li><a><progress max="100" value="75"></progress></a></li>
                            <li><a href="#">CONTINUE</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="pure-u-md-1-3">
                <div class="placard">
                    <img src="static/img/verbconju.png">
                    <div class="pure-menu pure-menu-open">
                        <a class="pure-menu-heading"><h4>Verb Conjugator</h4></a>

                        <ul>
                            <li><a><progress max="100" value="50"></progress></a></li>
                            <li><a href="#">CONTINUE</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- NOTE: this is for testing of Google's API client. Re-prettify it soon!
        ''' -->
        <div id="profile"></div>
        <div id="profileDialog">
            <div id="profileDialogContent">
                <div style=" display: inline-block; position:relative">
                    <img src= "{{  current_user.pic_url }}"/>
                   <!--<div style=" display: inline-block; width: 70px; background-color: powderblue; opacity: 0.7; position:absolute; left: 10px; top: 60px;">
                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i class="fa fa-edit"></i>
                    </div>-->
                </div>
                <div id="profile-name"> <p contenteditable="true"> {{current_user.username }}</p>&nbsp;<i class="fa fa-edit"></i></div>
                <div id="profileDialogButton">
                    <a class="button-small button-success pure-button" href="#" onclick="editProfile();" style="margin-left: 106px">Submit</a>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
{% block js %}

    $(document).ready(function() {
        var open = false;
        $("#profileDialogContent").hide();
        $("#profileDialogButton").hide();
        $('body').click(function(event) {
            //Hide the menus if visible
            if(event.target.id != 'profile-icon' && !!open){
                $('#profileDialog').animate({
                    height: '0px'},
                    200,
                    function(ctnr){
                        $("#profileDialogContent").hide();
                        $("#profileDialogButton").hide();
                    }
                );
                open = !open;
            }
        });

        $('#profile-icon').click(function (event) {
            event.stopPropagation();
            if(!open) {
                var autoHeight = $('#profileDialogContent').height();
                $('#profileDialog').animate({
                    height: autoHeight},
                    200,
                    function(ctnr){
                        $("#profileDialogContent").show();
                        $("#profileDialogButton").show();
                    }
                );
            } else {
                $('#profileDialog').animate({
                    height: '0px'},
                    200,
                    function(ctnr){
                        $("#profileDialogContent").hide();
                        $("#profileDialogButton").hide();
                    }
                );
            };
            open = !open;
        });
        $('#profileDialog').click(function (event) {
            event.stopPropagation();
        });
    });


    function editProfile(){
        var _new_name = $('#profile-name').children("p").text();
        $.ajax({
            type: 'POST',
            data :{
                new_name: _new_name,
             },
            url: '{{url_for('index.change_name')}}',
            success: function(data){
                window.location.href = "{{url_for('index.profile')}}";
            }
        });
    }
    /*
    var signOut = function(){
        gapi.auth.signOut();
        $.ajax({
            type: 'POST',
            data :{
                pic-url: "url",
             },
            url: '{{url_for('index.logout')}}',
            success: function(data){
                alert(data);
                window.location.href = "{{url_for('index.game')}}";
            }
        });
    };
    */

{% endblock %}
